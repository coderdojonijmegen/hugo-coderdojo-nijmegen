{{ partial "header" . }}

{{ if .Site.Params.mcs }}
    {{ partial "mcs-index" . }}
{{ else }}

<h1>{{ .Title }}</h1>

<article>
    {{ .Content }}
</article>

<article>
    <h1>Dojo</h1>
    De eerstvolgende dojo:

    {{ $scratch := newScratch }}
    {{ $scratch.Add "i" 0 }}
    {{ $now := now | time.Format "2006-01-02T15:04:05" }}
    {{ $maanden := .Site.Data.dagenenmaanden.maanden }}
    {{ $dagen := .Site.Data.dagenenmaanden.dagen }}
    {{ $pages := where .Site.RegularPages.ByDate "Section" "dojos" }}
    {{ range $pages }}
        {{ $wanneerVan := .Params.wanneer.van | time.Format "2006-01-02T15:04:05" }}
        {{ $k := $scratch.Get "i" }}
        {{ if and (ge $wanneerVan $now) (lt $k 1) }}
            {{ $scratch.Add "i" 1 }}
    <div class="dojo">
        <a href="{{ .RelPermalink }}">
        <div class="dojo-kop">
        {{ .Title }} -
        {{ with .Params }}
        <span>{{ index $dagen (dateFormat "Monday" .wanneer.van) }}
        {{ dateFormat "2" .wanneer.van }}
        {{ index $maanden (dateFormat "1" .wanneer.van) }}
        {{ dateFormat "2006" .wanneer.van }}</span> <span class="locatie">@ {{ .waar }}</span>
        {{ end }}
        </div>
        <p>{{ .Summary  }}
            {{ if .Truncated }}
            <br>
            <a href="{{ .RelPermalink }}">meerâ€¦</a>
            {{ end }}
        </p>
        </a>
    </div>
    {{ end }}
    {{ end }}

    <h2>Geplande dojo's</h2>
    {{ $scratch.Add "p" 0 }}
    {{ $now := now | time.Format "2006-01-02T15:04:05" }}
    {{ $maanden := .Site.Data.dagenenmaanden.maanden }}
    {{ $dagen := .Site.Data.dagenenmaanden.dagen }}
    {{ $pages := where .Site.RegularPages.ByDate "Section" "dojos" }}
    {{ range $pages }}
        {{ $wanneerVan := .Params.wanneer.van | time.Format "2006-01-02T15:04:05" }}
        {{ $k := $scratch.Get "p" }}
        {{ if ge $wanneerVan $now }}
            {{ if gt $k 0 }}
            <div class="geplandedojo">
                <a href="{{ .RelPermalink }}">
                <div class="dojo-kop">
                {{ .Title }} -
                {{ with .Params }}
                <span>{{ index $dagen (dateFormat "Monday" .wanneer.van) }}
                {{ dateFormat "2" .wanneer.van }}
                {{ index $maanden (dateFormat "1" .wanneer.van) }}
                    {{ dateFormat "2006" .wanneer.van }}</span> <span class="locatie">@ {{ .waar }}</span>
                {{ end }}
                </div>
                </a>
            </div>
            {{ end }}
            {{ $scratch.Add "p" 1 }}
        {{ end }}
    {{ end }}
        <p>
        alle <a href="{{(printf "%s" .Site.BaseURL)}}dojos">dojos</a>
    </p>

</article>
{{ end }}
{{ partial "footer" . }}